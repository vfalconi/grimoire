#!/bin/bash

# https://github.com/microsoft/WSL/issues/1350#issuecomment-844452775

VPN_NAME="$1"

echo "# generated by envpn on $(date +"%Y-%m-%d %H:%M:%S")" | tr -d '\r' | sudo tee /etc/resolv.conf
powershell.exe -Command 'Get-NetAdapter -Name "$VPN_NAME*" | Get-DnsClientServerAddress | Select -ExpandProperty ServerAddresses' | awk 'BEGIN { print } { print "nameserver", $1 }' | tr -d '\r' | sudo tee --append /etc/resolv.conf
powershell.exe -File 'C:\\Users\\vince\\dev\\Scripts\\vpn.ps1' -name "$VPN_NAME"
